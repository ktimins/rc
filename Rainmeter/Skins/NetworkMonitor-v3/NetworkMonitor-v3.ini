[Rainmeter]
Update=1000
Background=C:\Program Files\Rainmeter\Defaults\Skins\illustro\@Resources\Background.png
BackgroundMode=3
BackgroundMargins=0,34,0,14
ContextTitle=Change Target IP/Hostname...
ContextAction=[!CommandMeasure MeasureInputText "Executebatch 1"]
ContextTitle2=Reset to 8.8.8.8
ContextAction2=[!WriteKeyValue Variables TargetIP "8.8.8.8" "#CURRENTPATH#NetworkMonitor-v3.ini"][!Refresh]

[Metadata]
Name=Network Monitor v3
Author=KTimins
Information=Network ping monitor with illustro styling - binary bar status
Version=3.0.0
License=Creative Commons Attribution-Non-Commercial-Share Alike 3.0

[Variables]
; Variables declared here can be used later on between two # characters (e.g. #MyVariable#).

; Target Configuration
TargetIP=8.8.8.8
PingInterval=10
Timeout=5000

; Visual Configuration
fontName=Trebuchet MS
textSize=8
colorBar=235,170,0,255
colorBarDim=100,100,100,100
colorText=255,255,255,205

; Thresholds
AlertThreshold=3

; Internal variables (do not modify)
SuccessCount=0
TotalPings=0
History1=0
History2=0
History3=0
History4=0
History5=0
History6=0
History60sUptime=0
History60sSuccess=0
History60sTotal=0
DownCount=0
LastSuccessTime=--:--:--
ConsecutiveSuccess=0
ConsecutiveSuccessDisplay=0

;==========================================
; MEASURES - Ping and Calculations
;==========================================

[MeasurePing]
Measure=Plugin
Plugin=PingPlugin
DestAddress=#TargetIP#
UpdateRate=#PingInterval#
Timeout=#Timeout#
TimeoutValue=-1
FinishAction=[!UpdateMeasure MeasureHistory][!UpdateMeasure MeasureUptime][!CommandMeasure MeasureScript "UpdateHistory()"][!UpdateMeter *][!Redraw]

[MeasureHistory]
Measure=Calc
Formula=MeasurePing
IfCondition=(MeasurePing >= 0)
IfTrueAction=[!SetVariable SuccessCount "(#SuccessCount#+1)"][!SetVariable TotalPings "(#TotalPings#+1)"][!SetVariable LastSuccessTime "[MeasureTime]"]
IfFalseAction=[!SetVariable TotalPings "(#TotalPings#+1)"][!SetVariable DownCount "(#DownCount#+1)"]
DynamicVariables=1
UpdateDivider=#PingInterval#
Disabled=0

[MeasureUptime]
Measure=Calc
Formula=(#TotalPings# > 0) ? ((#SuccessCount# / #TotalPings#) * 100) : 0
MinValue=0
MaxValue=100
DynamicVariables=1

[MeasureHistory60s]
Measure=Calc
Formula=#History60sUptime#
MinValue=0
MaxValue=100
DynamicVariables=1

[MeasureLatency]
Measure=Calc
Formula=MeasurePing
MinValue=0
MaxValue=500
DynamicVariables=1

[MeasureStatus]
Measure=Calc
Formula=(MeasurePing >= 0) ? 100 : 0
MinValue=0
MaxValue=100
IfCondition=(MeasurePing >= 0)
IfTrueAction=[!SetOption meterValueStatus Text "UP"]
IfFalseAction=[!SetOption meterValueStatus Text "DOWN"]
DynamicVariables=1

[MeasureTime]
Measure=Time
Format=%I:%M:%S %p
DynamicVariables=1

[MeasureScript]
Measure=Script
ScriptFile=#@#HistoryManager.lua
UpdateDivider=-1

[MeasureInputText]
Measure=Plugin
Plugin=InputText
SolidColor=0,0,0,255
FontColor=255,255,255,255
FontSize=12
FontFace=Trebuchet MS
X=10
Y=40
W=280
H=20
AntiAlias=1
FocusDismiss=1
DefaultValue=#TargetIP#
Command1=[!WriteKeyValue Variables TargetIP "$UserInput$" "#CURRENTPATH#NetworkMonitor-v3.ini"][!Refresh]

;==========================================
; STYLES - Centralized options
;==========================================

[styleTitle]
StringAlign=Center
StringCase=Upper
StringStyle=Bold
StringEffect=Shadow
FontEffectColor=0,0,0,50
FontColor=#colorText#
FontFace=#fontName#
FontSize=10
AntiAlias=1
ClipString=1

[styleLeftText]
StringAlign=Left
StringCase=None
StringStyle=Bold
StringEffect=Shadow
FontEffectColor=0,0,0,20
FontColor=#colorText#
FontFace=#fontName#
FontSize=#textSize#
AntiAlias=1
ClipString=1

[styleRightText]
StringAlign=Right
StringCase=None
StringStyle=Bold
StringEffect=Shadow
FontEffectColor=0,0,0,20
FontColor=#colorText#
FontFace=#fontName#
FontSize=#textSize#
AntiAlias=1
ClipString=1

[styleBar]
BarColor=#colorBar#
BarOrientation=HORIZONTAL
SolidColor=255,255,255,15

;==========================================
; METERS - Visual Display
;==========================================

[meterTitle]
Meter=String
MeterStyle=styleTitle
X=100
Y=12
W=190
H=18
Text=Network Monitor

[meterTarget]
Meter=String
MeterStyle=styleLeftText
X=10
Y=40
W=190
H=14
Text=Target: #TargetIP#
DynamicVariables=1
LeftMouseUpAction=[!SetClip "#TargetIP#"]
RightMouseUpAction=[!CommandMeasure MeasureInputText "Executebatch 1"]
ToolTipText=Click to copy | Right-click to change

; Status Row
[meterLabelStatus]
Meter=String
MeterStyle=styleLeftText
X=10
Y=60
W=190
H=14
Text=Status:

[meterValueStatus]
Meter=String
MeterStyle=styleRightText
X=200
Y=0r
W=190
H=14
Text=DOWN
DynamicVariables=1

[meterBarStatus]
Meter=Bar
MeterStyle=styleBar
MeasureName=MeasureStatus
X=10
Y=72
W=190
H=1

; Latency Row
[meterLabelLatency]
Meter=String
MeterStyle=styleLeftText
X=10
Y=80
W=190
H=14
Text=Latency:

[meterValueLatency]
Meter=String
MeterStyle=styleRightText
MeasureName=MeasurePing
X=200
Y=0r
W=190
H=14
Text=%1ms
NumOfDecimals=0
DynamicVariables=1

; Consecutive Success Counter
[meterLabelUptime]
Meter=String
MeterStyle=styleLeftText
X=10
Y=100
W=190
H=14
Text=Consecutive:

[meterValueUptime]
Meter=String
MeterStyle=styleRightText
X=200
Y=0r
W=190
H=14
Text=#ConsecutiveSuccessDisplay#
DynamicVariables=1

; History Section
[meterLabelHistory]
Meter=String
MeterStyle=styleLeftText
X=10
Y=125
W=190
H=14
Text=History (60s):

[meterValueHistory]
Meter=String
MeterStyle=styleRightText
X=200
Y=0r
W=190
H=14
Text=#History60sSuccess#/6
DynamicVariables=1
IfCondition=(#History60sTotal# < 6)
IfTrueAction=[!SetOption meterValueHistory Text "#History60sSuccess#/#History60sTotal#"]
IfFalseAction=[!SetOption meterValueHistory Text "#History60sSuccess#/6"]

[meterBarHistory]
Meter=Bar
MeterStyle=styleBar
MeasureName=MeasureHistory60s
X=10
Y=137
W=190
H=1
